<!DOCTYPE html>
<html lang="ru" ng-app="clickerApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Clicker Game</title>
    
    <!-- Angular CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular-route.min.js"></script>
    
    <!-- Bootstrap для стилей -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome для иконок -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #6f42c1;
            --secondary: #20c997;
            --dark: #2d3748;
            --light: #f8f9fa;
            --background: #f5f7ff;
            --card-bg: #ffffff;
        }
        
        body {
            background-color: var(--background);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--dark);
            padding-top: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
        }
        
        .navbar {
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .click-area {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            transition: transform 0.2s;
            border: 1px solid rgba(111, 66, 193, 0.1);
        }
        
        .click-area:active {
            transform: scale(0.98);
        }
        
        .click-button {
            background: linear-gradient(135deg, var(--primary), #8b5ceb);
            border: none;
            border-radius: 50%;
            width: 160px;
            height: 160px;
            color: white;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(111, 66, 193, 0.3);
            transition: all 0.2s;
            margin: 20px 0;
        }
        
        .click-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(111, 66, 193, 0.4);
        }
        
        .click-button:active {
            transform: scale(0.95);
        }
        
        .stats-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .upgrade-item {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s;
            border-left: 4px solid var(--primary);
        }
        
        .upgrade-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn-upgrade {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-upgrade:hover {
            background: #198764;
            transform: translateY(-2px);
        }
        
        .btn-upgrade:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .nav-link {
            font-weight: 600;
            color: var(--dark);
            border-radius: 8px;
            margin: 0 5px;
            transition: all 0.2s;
        }
        
        .nav-link.active {
            background: rgba(111, 66, 193, 0.15);
            color: var(--primary);
        }
        
        .nav-link:hover {
            background: rgba(111, 66, 193, 0.1);
        }
        
        .coin-count {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary);
        }
        
        .pulse {
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes coinBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .coin-animation {
            animation: coinBounce 0.3s;
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .click-button {
                width: 130px;
                height: 130px;
                font-size: 18px;
            }
            
            .container {
                padding: 0 15px;
            }
            
            .coin-count {
                font-size: 24px;
            }
        }
        
        /* Темная тема */
        @media (prefers-color-scheme: dark) {
            :root {
                --background: #1a202c;
                --card-bg: #2d3748;
                --dark: #e2e8f0;
                --light: #4a5568;
            }
            
            body {
                background-color: var(--background);
                color: var(--dark);
            }
        }
    </style>
</head>
<body>
    <div class="container" ng-controller="MainController as main">
        <!-- Навигация -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-hand-pointer me-2"></i>Telegram Clicker
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="#!/" ng-class="{ active: $route.current.originalPath === '/' }">Игра</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#!/upgrades" ng-class="{ active: $route.current.originalPath === '/upgrades' }">Улучшения</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#!/stats" ng-class="{ active: $route.current.originalPath === '/stats' }">Статистика</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Контент с маршрутизацией -->
        <div ng-view></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Создаем Angular приложение
        var app = angular.module('clickerApp', ['ngRoute']);
        
        // Конфигурация маршрутов
        app.config(function($routeProvider) {
            $routeProvider
                .when('/', {
                    template: `
                        <div class="click-area" ng-class="{'pulse': game.clickAnimation}">
                            <h2>Ваши монеты: <span class="coin-count" ng-class="{'coin-animation': game.coinAnimation}">{{gameState.coins}}</span></h2>
                            <p>Доход в секунду: {{gameState.coinsPerSecond}}</p>
                            
                            <button class="click-button" ng-click="game.handleClick()">
                                <i class="fas fa-coins fa-2x"></i><br>
                                Клик!<br>
                                +{{gameState.coinsPerClick}}
                            </button>
                            
                            <div class="mt-3">
                                <small class="text-muted">Нажимайте на кнопку или используйте пробел</small>
                            </div>
                        </div>
                        
                        <div class="stats-card">
                            <h4><i class="fas fa-chart-line me-2"></i>Быстрые улучшения</h4>
                            <div class="row">
                                <div class="col-md-6" ng-repeat="upgrade in gameState.upgrades | limitTo:2">
                                    <div class="upgrade-item">
                                        <h5>{{upgrade.name}}</h5>
                                        <p>Стоимость: {{upgrade.cost}} монет</p>
                                        <button class="btn-upgrade" ng-click="upgrades.purchaseUpgrade(upgrade.id)" ng-disabled="gameState.coins < upgrade.cost">
                                            Купить ({{upgrade.purchased}})
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `,
                    controller: 'GameController'
                })
                .when('/upgrades', {
                    template: `
                        <div class="stats-card">
                            <h2><i class="fas fa-arrow-up me-2"></i>Улучшения</h2>
                            <p>Увеличивайте свою мощь и зарабатывайте больше монет!</p>
                        </div>
                        
                        <div class="upgrade-item" ng-repeat="upgrade in gameState.upgrades" ng-class="{'pulse': upgrades.purchaseAnimation === upgrade.id}">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5>{{upgrade.name}}</h5>
                                    <p class="mb-1">+{{upgrade.increase}} {{upgrade.type == 'click' ? 'за клик' : 'в секунду'}}</p>
                                    <p class="mb-0">Стоимость: {{upgrade.cost}} монет</p>
                                </div>
                                <button class="btn-upgrade" ng-click="upgrades.purchaseUpgrade(upgrade.id)" ng-disabled="gameState.coins < upgrade.cost">
                                    Купить ({{upgrade.purchased}})
                                </button>
                            </div>
                        </div>
                    `,
                    controller: 'UpgradesController'
                })
                .when('/stats', {
                    template: `
                        <div class="stats-card">
                            <h2><i class="fas fa-chart-pie me-2"></i>Статистика</h2>
                            <p>Здесь вы можете увидеть свой прогресс в игре</p>
                        </div>
                        
                        <div class="stats-card">
                            <h4><i class="fas fa-coins me-2"></i>Общая статистика</h4>
                            <p>Всего монет: <strong>{{gameState.coins}}</strong></p>
                            <p>Монет за клик: <strong>{{gameState.coinsPerClick}}</strong></p>
                            <p>Монет в секунду: <strong>{{gameState.coinsPerSecond}}</strong></p>
                            <p>Всего улучшений: <strong>{{getTotalUpgrades()}}</strong></p>
                        </div>
                        
                        <div class="stats-card">
                            <h4><i class="fas fa-trophy me-2"></i>Достижения</h4>
                            <p>Первые шаги: {{gameState.coins >= 10 ? '✔️' : '❌'}} 10 монет</p>
                            <p>Начинающий кликер: {{gameState.coins >= 100 ? '✔️' : '❌'}} 100 монет</p>
                            <p>Профессионал: {{gameState.coins >= 1000 ? '✔️' : '❌'}} 1000 монет</p>
                            <p>Властелин кликов: {{gameState.coins >= 10000 ? '✔️' : '❌'}} 10,000 монет</p>
                        </div>
                        
                        <div class="stats-card text-center">
                            <button class="btn btn-danger" ng-click="stats.resetGame()">
                                <i class="fas fa-trash me-2"></i>Сбросить игру
                            </button>
                        </div>
                    `,
                    controller: 'StatsController'
                })
                .otherwise({
                    redirectTo: '/'
                });
        });
        
        // Сервис для управления игровым состоянием
        app.factory('GameService', function() {
            var gameState = {
                coins: 100,
                coinsPerClick: 1,
                coinsPerSecond: 0,
                upgrades: [
                    { id: 1, name: "Улучшенный клик", cost: 10, increase: 1, type: "click", purchased: 0 },
                    { id: 2, name: "Автокликер", cost: 50, increase: 1, type: "auto", purchased: 0 },
                    { id: 3, name: "Двойной клик", cost: 200, increase: 2, type: "click", purchased: 0 },
                    { id: 4, name: "Супер автокликер", cost: 500, increase: 5, type: "auto", purchased: 0 }
                ]
            };
            
            // Загрузка состояния из localStorage
            var loadGame = function() {
                var savedGame = localStorage.getItem('telegramClickerGame');
                if (savedGame) {
                    gameState = JSON.parse(savedGame);
                }
            };
            
            // Сохранение состояния в localStorage
            var saveGame = function() {
                localStorage.setItem('telegramClickerGame', JSON.stringify(gameState));
            };
            
            // Инициализация игры
            loadGame();
            
            return {
                getState: function() {
                    return gameState;
                },
                
                addCoins: function(amount) {
                    gameState.coins += amount;
                    saveGame();
                },
                
                purchaseUpgrade: function(upgradeId) {
                    var upgrade = gameState.upgrades.find(u => u.id === upgradeId);
                    
                    if (gameState.coins >= upgrade.cost) {
                        gameState.coins -= upgrade.cost;
                        
                        if (upgrade.type === "click") {
                            gameState.coinsPerClick += upgrade.increase;
                        } else if (upgrade.type === "auto") {
                            gameState.coinsPerSecond += upgrade.increase;
                        }
                        
                        upgrade.purchased++;
                        upgrade.cost = Math.floor(upgrade.cost * 1.5);
                        
                        saveGame();
                        return true;
                    }
                    
                    return false;
                },
                
                resetGame: function() {
                    gameState = {
                        coins: 0,
                        coinsPerClick: 1,
                        coinsPerSecond: 0,
                        upgrades: [
                            { id: 1, name: "Улучшенный клик", cost: 10, increase: 1, type: "click", purchased: 0 },
                            { id: 2, name: "Автокликер", cost: 50, increase: 1, type: "auto", purchased: 0 },
                            { id: 3, name: "Двойной клик", cost: 200, increase: 2, type: "click", purchased: 0 },
                            { id: 4, name: "Супер автокликер", cost: 500, increase: 5, type: "auto", purchased: 0 }
                        ]
                    };
                    
                    saveGame();
                }
            };
        });
        
        // Главный контроллер
        app.controller('MainController', function($scope, GameService) {
            var vm = this;
            vm.gameState = GameService.getState();
            
            // Автоматическое начисление монет
            setInterval(function() {
                if (vm.gameState.coinsPerSecond > 0) {
                    GameService.addCoins(vm.gameState.coinsPerSecond / 10);
                    $scope.$apply();
                }
            }, 100);
            
            // Обработка нажатия пробела для клика
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space') {
                    event.preventDefault();
                    GameService.addCoins(vm.gameState.coinsPerClick);
                    $scope.$apply();
                }
            });
        });
        
        // Контроллер игры
        app.controller('GameController', function($scope, GameService) {
            var vm = this;
            vm.gameState = GameService.getState();
            
            vm.handleClick = function() {
                GameService.addCoins(vm.gameState.coinsPerClick);
                vm.clickAnimation = true;
                
                setTimeout(function() {
                    vm.clickAnimation = false;
                    $scope.$apply();
                }, 300);
            };
            
            // Анимация монет каждую секунду, если есть авто-клики
            setInterval(function() {
                vm.coinAnimation = true;
                setTimeout(function() {
                    vm.coinAnimation = false;
                    $scope.$apply();
                }, 300);
            }, 1000);
        });
        
        // Контроллер улучшений
        app.controller('UpgradesController', function($scope, GameService) {
            var vm = this;
            vm.gameState = GameService.getState();
            
            vm.purchaseUpgrade = function(upgradeId) {
                var success = GameService.purchaseUpgrade(upgradeId);
                
                if (success) {
                    vm.purchaseAnimation = upgradeId;
                    
                    setTimeout(function() {
                        vm.purchaseAnimation = null;
                        $scope.$apply();
                    }, 1000);
                }
            };
        });
        
        // Контроллер статистики
        app.controller('StatsController', function($scope, GameService) {
            var vm = this;
            vm.gameState = GameService.getState();
            
            vm.getTotalUpgrades = function() {
                return vm.gameState.upgrades.reduce(function(total, upgrade) {
                    return total + upgrade.purchased;
                }, 0);
            };
            
            vm.resetGame = function() {
                if (confirm("Вы уверены, что хотите сбросить весь прогресс?")) {
                    GameService.resetGame();
                    vm.gameState = GameService.getState();
                }
            };
        });
        
        // Инициализация Telegram Web App
        app.run(function(GameService) {
            // Проверяем, запущено ли приложение в Telegram
            if (window.Telegram && Telegram.WebApp) {
                // Расширяем приложение на весь экран
                Telegram.WebApp.expand();
                
                // Настройка основной кнопки
                Telegram.WebApp.MainButton.setText("Поделиться результатом");
                Telegram.WebApp.MainButton.show();
                
                // Обработчик нажатия на основную кнопку
                Telegram.WebApp.MainButton.onClick(function() {
                    var gameState = GameService.getState();
                    var shareText = `Я заработал ${gameState.coins} монет в Telegram Clicker!`;
                    
                    Telegram.WebApp.sendData(shareText);
                });
                
                // Получаем данные пользователя
                var user = Telegram.WebApp.initDataUnsafe.user;
                if (user) {
                    console.log("User:", user);
                    // Можно сохранить информацию о пользователе для персонализации
                }
            }
        });
    </script>
</body>
</html>
