<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Crypto Hunt</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
    :root {
        --primary-color: #6C5CE7;
        --primary-dark: #5649C0;
        --primary-light: #E6E4FF;
        --secondary-color: #00B894;
        --accent-color: #FDCB6E;
        --danger-color: #D63031;
        --dark-bg: #1A1A2E;
        --card-bg: #16213E;
        --card-bg-light: #2D4263;
        --text: #FFFFFF;
        --text-light: #B8B8B8;
        --border: #2D4263;
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
        --shadow: 0 4px 6px rgba(0, 0, 0, 0.25);
        --shadow-md: 0 10px 20px rgba(0, 0, 0, 0.3);
        --rounded-sm: 8px;
        --rounded: 12px;
        --rounded-lg: 16px;
        --rounded-xl: 20px;
        --section-padding: 16px;
        --neon-glow: 0 0 10px rgba(108, 92, 231, 0.7);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
        background-color: var(--dark-bg);
        color: var(--text);
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
    }

    h1, h2, h3, h4 {
        font-family: 'Orbitron', sans-serif;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 16px;
        letter-spacing: 0.5px;
    }

    .container {
        max-width: 100%;
        margin: 0 auto;
        padding: var(--section-padding);
        padding-bottom: 80px;
    }

    /* Шапка */
    .header {
        background-color: var(--card-bg);
        color: var(--text);
        padding: 12px var(--section-padding);
        position: sticky;
        top: 0;
        z-index: 100;
        border-bottom: 1px solid var(--border);
        box-shadow: var(--shadow-sm);
    }

    .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        max-width: 100%;
        margin: 0 auto;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 18px;
        font-weight: 700;
        font-family: 'Orbitron', sans-serif;
        color: var(--primary-color);
        text-shadow: var(--neon-glow);
    }

    .logo i {
        font-size: 20px;
    }

    .user-profile {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background-color: var(--primary-color);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
    }

    /* Карта */
    #map {
        height: 400px;
        width: 100%;
        border-radius: var(--rounded-lg);
        margin-bottom: 16px;
        border: 2px solid var(--primary-color);
        box-shadow: var(--shadow);
    }

    /* Карточка клада */
    .treasure-card {
        background-color: var(--card-bg-light);
        color: var(--text);
        padding: 16px;
        border-radius: var(--rounded-lg);
        margin-bottom: 16px;
        box-shadow: var(--shadow);
        border-left: 4px solid var(--primary-color);
    }

    .treasure-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--accent-color);
        text-align: center;
        margin: 10px 0;
        font-family: 'Orbitron', sans-serif;
    }

    .treasure-distance {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }

    .distance-label {
        display: flex;
        align-items: center;
        gap: 6px;
        color: var(--text-light);
    }

    .distance-value {
        font-weight: 500;
        color: var(--text);
    }

    .treasure-timer {
        display: flex;
        align-items: center;
        gap: 6px;
        color: var(--danger-color);
        font-weight: 500;
    }

    /* Кнопка сбора */
    .claim-btn {
        display: block;
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        border: none;
        border-radius: var(--rounded);
        font-size: 18px;
        font-weight: 600;
        font-family: 'Orbitron', sans-serif;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: var(--shadow-sm);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .claim-btn:disabled {
        background: var(--card-bg-light);
        color: var(--text-light);
        cursor: not-allowed;
        box-shadow: none;
    }

    .claim-btn.active {
        box-shadow: 0 0 15px rgba(108, 92, 231, 0.7);
    }

    /* Навигация */
    .mobile-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: var(--card-bg);
        display: flex;
        justify-content: space-around;
        padding: 12px 0;
        border-top: 1px solid var(--border);
        z-index: 100;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--text-light);
        text-decoration: none;
        font-size: 12px;
        flex: 1;
        position: relative;
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px 0;
        transition: all 0.2s;
    }

    .nav-item.active {
        color: var(--primary-color);
        transform: translateY(-5px);
    }

    .nav-item i {
        font-size: 20px;
        margin-bottom: 4px;
    }

    .nav-item.active i {
        text-shadow: 0 0 10px rgba(108, 92, 231, 0.7);
    }

    /* Страница профиля */
    .profile-section {
        background-color: var(--card-bg-light);
        border-radius: var(--rounded-lg);
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: var(--shadow-sm);
    }

    .profile-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 16px;
    }

    .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background-color: var(--primary-color);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 32px;
        font-weight: bold;
    }

    .profile-info h3 {
        margin-bottom: 4px;
    }

    .profile-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 16px;
    }

    .stat-card {
        background-color: var(--card-bg);
        border-radius: var(--rounded);
        padding: 12px;
        text-align: center;
    }

    .stat-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--accent-color);
        font-family: 'Orbitron', sans-serif;
    }

    .stat-label {
        font-size: 12px;
        color: var(--text-light);
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Реферальная система */
    .referral-card {
        background-color: var(--card-bg-light);
        border-radius: var(--rounded-lg);
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: var(--shadow-sm);
    }

    .referral-code {
        background-color: var(--card-bg);
        border-radius: var(--rounded);
        padding: 12px;
        font-family: monospace;
        text-align: center;
        margin: 12px 0;
        word-break: break-all;
    }

    .copy-btn {
        width: 100%;
        padding: 12px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: var(--rounded);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .copy-btn:hover {
        background-color: var(--primary-dark);
    }

    /* Анимации */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .pulse {
        animation: pulse 2s infinite;
    }

    /* Уведомления */
    .notification-container {
        position: fixed;
        top: 16px;
        right: 16px;
        z-index: 2000;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .notification {
        background-color: var(--card-bg-light);
        border-radius: var(--rounded);
        padding: 12px;
        box-shadow: var(--shadow-md);
        display: flex;
        align-items: center;
        gap: 8px;
        transform: translateX(150%);
        transition: transform 0.3s ease;
        border-left: 4px solid transparent;
        width: 300px;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification i {
        font-size: 20px;
    }

    .notification.success {
        border-left-color: var(--secondary-color);
    }

    .notification.warning {
        border-left-color: var(--accent-color);
    }

    .notification.error {
        border-left-color: var(--danger-color);
    }

    /* Адаптивность */
    @media (max-width: 768px) {
        .profile-stats {
            grid-template-columns: 1fr;
        }
        
        #map {
            height: 300px;
        }
    }

    @media (max-width: 480px) {
        .notification {
            width: 90%;
            left: 5%;
            right: 5%;
        }
    }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function ErrorBoundary({ children }) {
            const [hasError, setHasError] = useState(false);

            useEffect(() => {
                const errorHandler = (error) => {
                    console.error('Error caught by ErrorBoundary:', error);
                    setHasError(true);
                };
                
                window.addEventListener('error', errorHandler);
                return () => window.removeEventListener('error', errorHandler);
            }, []);

            if (hasError) {
                return (
                    <div className="treasure-card" style={{ color: 'var(--danger-color)' }}>
                        <h4>Произошла ошибка</h4>
                        <p>Пожалуйста, перезагрузите страницу</p>
                    </div>
                );
            }

            return children;
        }

        function App() {
            // Состояния приложения
            const [activeTab, setActiveTab] = useState("treasures");
            const [userPosition, setUserPosition] = useState(null);
            const [treasures, setTreasures] = useState([]);
            const [selectedTreasure, setSelectedTreasure] = useState(null);
            const [distance, setDistance] = useState(0);
            const [timeLeft, setTimeLeft] = useState(15 * 60); // 15 минут в секундах
            const [claimedTreasures, setClaimedTreasures] = useState([]);
            const [notifications, setNotifications] = useState([]);
            const [userData, setUserData] = useState({
                name: "CryptoHunter",
                balance: 0,
                treasuresFound: 0,
                referralCode: "CRYPTO123",
                referrals: 5
            });
            const [lastTreasureUpdate, setLastTreasureUpdate] = useState(null);
            
            const notificationTimeoutRef = useRef(null);
            const timerRef = useRef(null);
            const mapRef = useRef(null);
            const userMarkerRef = useRef(null);
            const treasureMarkersRef = useRef([]);
            const mapInitializedRef = useRef(false);
            const mapContainerRef = useRef(null);

            // Показать уведомление
            const showNotification = (message, type = "info", duration = 3000) => {
                try {
                    const id = Date.now();
                    const notification = { id, message, type };
                    
                    setNotifications(prev => [...prev, notification]);
                    
                    if (notificationTimeoutRef.current) {
                        clearTimeout(notificationTimeoutRef.current);
                    }
                    
                    notificationTimeoutRef.current = setTimeout(() => {
                        setNotifications(prev => prev.filter(n => n.id !== id));
                    }, duration);
                } catch (error) {
                    console.error('Error in showNotification:', error);
                }
            };

            // Расчет расстояния между двумя точками в метрах
            const calculateDistance = (lat1, lon1, lat2, lon2) => {
                try {
                    const R = 6371e3; // радиус Земли в метрах
                    const φ1 = lat1 * Math.PI/180;
                    const φ2 = lat2 * Math.PI/180;
                    const Δφ = (lat2-lat1) * Math.PI/180;
                    const Δλ = (lon2-lon1) * Math.PI/180;
                    
                    const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                              Math.cos(φ1) * Math.cos(φ2) *
                              Math.sin(Δλ/2) * Math.sin(Δλ/2);
                    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                    
                    return R * c;
                } catch (error) {
                    console.error('Error in calculateDistance:', error);
                    return Infinity;
                }
            };

            // Генерация случайных кладов вокруг пользователя
            const generateTreasures = (lat, lng, count = 10) => {
                try {
                    const newTreasures = [];
                    const radius = 0.05; // ~5 км
                    
                    for (let i = 0; i < count; i++) {
                        const randomLat = lat + (Math.random() * radius * 2 - radius);
                        const randomLng = lng + (Math.random() * radius * 2 - radius);
                        const value = Math.floor(Math.random() * 900) + 100; // 100-1000 токенов
                        
                        newTreasures.push({
                            id: `treasure-${i}`,
                            lat: randomLat,
                            lng: randomLng,
                            value: value,
                            claimed: false
                        });
                    }
                    
                    // Сохраняем время генерации кладов
                    const now = new Date().toISOString();
                    localStorage.setItem('lastTreasureUpdate', now);
                    setLastTreasureUpdate(now);
                    
                    return newTreasures;
                } catch (error) {
                    console.error('Error in generateTreasures:', error);
                    return [];
                }
            };

            // Проверка, нужно ли обновить клады
            const shouldUpdateTreasures = () => {
                try {
                    const lastUpdate = localStorage.getItem('lastTreasureUpdate');
                    if (!lastUpdate) return true;
                    
                    const lastUpdateDate = new Date(lastUpdate);
                    const now = new Date();
                    const diffDays = (now - lastUpdateDate) / (1000 * 60 * 60 * 24);
                    
                    return diffDays >= 1; // Обновляем раз в сутки
                } catch (error) {
                    console.error('Error in shouldUpdateTreasures:', error);
                    return true;
                }
            };

            // Обновление позиции пользователя
            const updatePosition = (position) => {
                try {
                    if (!position || !position.coords) return;
                    
                    const newPosition = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    setUserPosition(newPosition);
                    
                    // Центрируем карту на пользователе
                    if (mapRef.current) {
                        mapRef.current.setView([newPosition.lat, newPosition.lng], 15);
                    }
                    
                    // Обновляем маркер пользователя
                    if (userMarkerRef.current) {
                        userMarkerRef.current.setLatLng([newPosition.lat, newPosition.lng]);
                    } else if (mapRef.current) {
                        userMarkerRef.current = L.marker([newPosition.lat, newPosition.lng], {
                            icon: L.divIcon({
                                html: '<i class="fas fa-user" style="color: #6C5CE7; font-size: 24px;"></i>',
                                className: 'user-marker',
                                iconSize: [30, 30]
                            })
                        }).addTo(mapRef.current);
                    }
                    
                    // Генерируем клады при первом получении позиции или если прошли сутки
                    if (treasures.length === 0 || shouldUpdateTreasures()) {
                        const newTreasures = generateTreasures(newPosition.lat, newPosition.lng, 10000);
                        setTreasures(newTreasures);
                        addTreasureMarkers(newTreasures);
                    }
                    
                    // Обновляем расстояние до выбранного клада
                    if (selectedTreasure) {
                        const dist = calculateDistance(
                            newPosition.lat,
                            newPosition.lng,
                            selectedTreasure.lat,
                            selectedTreasure.lng
                        );
                        setDistance(dist);
                    }
                } catch (error) {
                    console.error('Error in updatePosition:', error);
                    showNotification("Ошибка обновления позиции", "error");
                }
            };

            // Добавление маркеров кладов на карту
            const addTreasureMarkers = (treasures) => {
                try {
                    if (!mapRef.current) return;
                    
                    // Очищаем старые маркеры
                    treasureMarkersRef.current.forEach(marker => {
                        try {
                            if (marker && marker.remove) marker.remove();
                        } catch (e) {
                            console.error('Error removing marker:', e);
                        }
                    });
                    treasureMarkersRef.current = [];
                    
                    // Добавляем новые маркеры
                    treasures.forEach(treasure => {
                        if (!treasure.claimed) {
                            const marker = L.marker([treasure.lat, treasure.lng], {
                                icon: L.divIcon({
                                    html: '<i class="fas fa-coins" style="color: #FDCB6E; font-size: 24px;"></i>',
                                    className: 'treasure-marker',
                                    iconSize: [30, 30]
                                })
                            }).addTo(mapRef.current);
                            
                            marker.on('click', () => selectTreasure(treasure));
                            treasureMarkersRef.current.push(marker);
                        }
                    });
                } catch (error) {
                    console.error('Error in addTreasureMarkers:', error);
                }
            };

            // Выбор клада
            const selectTreasure = (treasure) => {
                try {
                    if (!treasure) return;
                    
                    setSelectedTreasure(treasure);
                    
                    if (userPosition) {
                        const dist = calculateDistance(
                            userPosition.lat,
                            userPosition.lng,
                            treasure.lat,
                            treasure.lng
                        );
                        setDistance(dist);
                    }
                    
                    // Сброс таймера
                    setTimeLeft(15 * 60);
                    
                    // Центрируем карту на кладе
                    if (mapRef.current) {
                        mapRef.current.setView([treasure.lat, treasure.lng], 15);
                    }
                } catch (error) {
                    console.error('Error in selectTreasure:', error);
                    showNotification("Ошибка выбора клада", "error");
                }
            };

            // Сбор клада
            const claimTreasure = () => {
                try {
                    if (!selectedTreasure || distance > 50) return;
                    
                    // Обновляем состояние клада
                    const updatedTreasures = treasures.map(t => 
                        t.id === selectedTreasure.id ? { ...t, claimed: true } : t
                    );
                    
                    setTreasures(updatedTreasures);
                    setClaimedTreasures(prev => [...prev, selectedTreasure.id]);
                    
                    // Обновляем баланс пользователя
                    setUserData(prev => ({
                        ...prev,
                        balance: prev.balance + selectedTreasure.value,
                        treasuresFound: prev.treasuresFound + 1
                    }));
                    
                    // Показываем уведомление
                    showNotification(`Вы нашли клад! +${selectedTreasure.value} токенов`, "success");
                    
                    // Удаляем маркер клада
                    const markerIndex = treasureMarkersRef.current.findIndex(
                        m => m && m.getLatLng && 
                             m.getLatLng().lat === selectedTreasure.lat && 
                             m.getLatLng().lng === selectedTreasure.lng
                    );
                    
                    if (markerIndex !== -1) {
                        try {
                            treasureMarkersRef.current[markerIndex].remove();
                            treasureMarkersRef.current.splice(markerIndex, 1);
                        } catch (e) {
                            console.error('Error removing marker:', e);
                        }
                    }
                    
                    // Сбрасываем выбранный клад
                    setSelectedTreasure(null);
                } catch (error) {
                    console.error('Error in claimTreasure:', error);
                    showNotification("Ошибка сбора клада", "error");
                }
            };

            // Копирование реферального кода
            const copyReferralCode = () => {
                try {
                    navigator.clipboard.writeText(userData.referralCode);
                    showNotification("Реферальный код скопирован", "success");
                } catch (error) {
                    console.error('Error copying referral code:', error);
                    showNotification("Не удалось скопировать код", "error");
                }
            };

            // Инициализация карты
            const initMap = () => {
                try {
                    if (!mapInitializedRef.current && document.getElementById('map')) {
                        mapRef.current = L.map('map').setView([0, 0], 15);
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                        }).addTo(mapRef.current);
                        mapInitializedRef.current = true;
                        
                        // Если есть пользовательская позиция, центрируем карту
                        if (userPosition) {
                            mapRef.current.setView([userPosition.lat, userPosition.lng], 15);
                        }
                    }
                } catch (error) {
                    console.error('Error initializing map:', error);
                    showNotification("Ошибка загрузки карты", "error");
                }
            };

            // Уничтожение карты
            const destroyMap = () => {
                try {
                    if (mapRef.current) {
                        mapRef.current.remove();
                        mapRef.current = null;
                        mapInitializedRef.current = false;
                        userMarkerRef.current = null;
                        treasureMarkersRef.current = [];
                    }
                } catch (e) {
                    console.error('Error cleaning up map:', e);
                }
            };

            // Инициализация при монтировании
            useEffect(() => {
                // Загружаем время последнего обновления кладов
                const lastUpdate = localStorage.getItem('lastTreasureUpdate');
                if (lastUpdate) {
                    setLastTreasureUpdate(lastUpdate);
                }
                
                return () => {
                    // Очистка при размонтировании
                    if (timerRef.current) {
                        clearInterval(timerRef.current);
                    }
                    if (notificationTimeoutRef.current) {
                        clearTimeout(notificationTimeoutRef.current);
                    }
                };
            }, []);

            // Запрос геолокации
            useEffect(() => {
                let watchId = null;
                
                try {
                    if (navigator.geolocation) {
                        watchId = navigator.geolocation.watchPosition(
                            updatePosition,
                            (error) => {
                                console.error('Ошибка геолокации:', error);
                                showNotification("Разрешите доступ к геолокации для игры", "error");
                            },
                            {
                                enableHighAccuracy: true,
                                maximumAge: 10000,
                                timeout: 5000
                            }
                        );
                    } else {
                        showNotification("Ваш браузер не поддерживает геолокацию", "error");
                    }
                } catch (error) {
                    console.error('Error setting up geolocation:', error);
                    showNotification("Ошибка доступа к геолокации", "error");
                }
                
                return () => {
                    if (watchId && navigator.geolocation) {
                        navigator.geolocation.clearWatch(watchId);
                    }
                };
            }, []);

            // Управление картой при переключении вкладок
            useEffect(() => {
                if (activeTab === "treasures") {
                    // При переходе на вкладку с картой инициализируем карту
                    initMap();
                    
                    // Обновляем маркеры, если они есть
                    if (treasures.length > 0) {
                        addTreasureMarkers(treasures);
                    }
                } else {
                    // При переходе на другие вкладки уничтожаем карту
                    destroyMap();
                }
                
                return () => {
                    // При размонтировании или смене вкладки уничтожаем карту
                    if (activeTab !== "treasures") {
                        destroyMap();
                    }
                };
            }, [activeTab, treasures]);

            // Таймер обратного отсчета
            useEffect(() => {
                try {
                    if (selectedTreasure && timeLeft > 0) {
                        timerRef.current = setInterval(() => {
                            setTimeLeft(prev => prev - 1);
                        }, 1000);
                    }
                } catch (error) {
                    console.error('Error setting up timer:', error);
                }
                
                return () => {
                    if (timerRef.current) {
                        clearInterval(timerRef.current);
                    }
                };
            }, [selectedTreasure]);

            // Сброс клада при истечении времени
            useEffect(() => {
                try {
                    if (timeLeft <= 0 && selectedTreasure) {
                        showNotification("Время вышло! Клад исчез.", "error");
                        setSelectedTreasure(null);
                    }
                } catch (error) {
                    console.error('Error handling timer expiration:', error);
                }
            }, [timeLeft]);

            // Рендер уведомлений
            const renderNotifications = () => (
                <div className="notification-container">
                    {notifications.map(notification => (
                        <div key={notification.id} className={`notification ${notification.type} show`}>
                            <i className={`fas ${
                                notification.type === "success" ? "fa-check-circle" :
                                notification.type === "warning" ? "fa-exclamation-circle" :
                                "fa-info-circle"
                            }`}></i>
                            <span>{notification.message}</span>
                        </div>
                    ))}
                </div>
            );

            // Рендер страницы с кладами
            const renderTreasuresPage = () => (
                <div className="page">
                    <h2><i className="fas fa-coins"></i> Охота за кладами</h2>
                    
                    <div id="map" ref={mapContainerRef}></div>
                    
                    {selectedTreasure ? (
                        <div className="treasure-card">
                            <h4>Выбранный клад</h4>
                            <div className="treasure-distance">
                                <div className="distance-label">
                                    <i className="fas fa-location-arrow"></i>
                                    <span>Дистанция:</span>
                                </div>
                                <div className="distance-value">{Math.round(distance)} м</div>
                            </div>
                            
                            <div className="treasure-timer">
                                <i className="fas fa-clock"></i>
                                <span>
                                    {Math.floor(timeLeft / 60)}:{timeLeft % 60 < 10 ? '0' : ''}{timeLeft % 60}
                                </span>
                            </div>
                            
                            <button 
                                className={`claim-btn ${distance <= 50 ? 'active pulse' : ''}`}
                                onClick={claimTreasure}
                                disabled={distance > 50}
                            >
                                {distance <= 50 ? 
                                    `Забрать ${selectedTreasure.value} токенов` : 
                                    "Подойдите ближе"}
                            </button>
                        </div>
                    ) : (
                        <div className="treasure-card">
                            <h4>Выберите клад на карте</h4>
                            <p>Нажмите на любой клад на карте, чтобы начать охоту</p>
                            <div className="treasure-value">
                                Найдено: {userData.treasuresFound} кладов
                            </div>
                            {lastTreasureUpdate && (
                                <p style={{ fontSize: '12px', color: 'var(--text-light)', textAlign: 'center' }}>
                                    Последнее обновление кладов: {new Date(lastTreasureUpdate).toLocaleString()}
                                </p>
                            )}
                        </div>
                    )}
                </div>
            );

            // Рендер страницы профиля
            const renderProfilePage = () => (
                <div className="page">
                    <h2><i className="fas fa-user"></i> Профиль</h2>
                    
                    <div className="profile-section">
                        <div className="profile-header">
                            <div className="profile-avatar">
                                {userData.name.charAt(0)}
                            </div>
                            <div className="profile-info">
                                <h3>{userData.name}</h3>
                                <p>Охотник за кладами</p>
                            </div>
                        </div>
                        
                        <div className="profile-stats">
                            <div className="stat-card">
                                <div className="stat-value">{userData.balance}</div>
                                <div className="stat-label">Токенов</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-value">{userData.treasuresFound}</div>
                                <div className="stat-label">Кладов</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-value">{userData.referrals}</div>
                                <div className="stat-label">Рефералов</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-value">{claimedTreasures.length}</div>
                                <div className="stat-label">Найдено</div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            // Рендер реферальной страницы
            const renderReferralPage = () => (
                <div className="page">
                    <h2><i className="fas fa-users"></i> Реферальная программа</h2>
                    
                    <div className="referral-card">
                        <h4>Приглашайте друзей и получайте бонусы</h4>
                        <p>За каждого приглашенного друга вы получите 10% от его первых 5 кладов</p>
                        
                        <div className="referral-code">
                            {userData.referralCode}
                        </div>
                        
                        <button 
                            className="copy-btn"
                            onClick={copyReferralCode}
                        >
                            <i className="fas fa-copy"></i> Копировать код
                        </button>
                    </div>
                    
                    <div className="profile-stats">
                        <div className="stat-card">
                            <div className="stat-value">{userData.referrals}</div>
                            <div className="stat-label">Приглашено</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-value">{userData.referrals * 50}</div>
                            <div className="stat-label">Заработано</div>
                        </div>
                    </div>
                </div>
            );

            return (
                <ErrorBoundary>
                    <div className="app">
                        {/* Шапка */}
                        <header className="header">
                            <div className="header-content">
                                <div className="logo">
                                    <i className="fas fa-coins"></i>
                                    <span>Crypto Hunt</span>
                                </div>
                                <div className="user-profile">
                                    <span>{userData.balance} $TOKEN</span>
                                    <div className="user-avatar">
                                        {userData.name.charAt(0)}
                                    </div>
                                </div>
                            </div>
                        </header>

                        <div className="container">
                            {/* Основной экран с кладами */}
                            {activeTab === "treasures" && renderTreasuresPage()}
                            
                            {/* Экран профиля */}
                            {activeTab === "profile" && renderProfilePage()}
                            
                            {/* Реферальная программа */}
                            {activeTab === "referral" && renderReferralPage()}
                        </div>

                        {/* Уведомления */}
                        {renderNotifications()}

                        {/* Мобильная навигация */}
                        <nav className="mobile-nav">
                            <button 
                                className={`nav-item ${activeTab === "treasures" ? "active" : ""}`}
                                onClick={() => setActiveTab("treasures")}
                            >
                                <i className="fas fa-coins"></i>
                                <span>Клады</span>
                            </button>
                            <button 
                                className={`nav-item ${activeTab === "profile" ? "active" : ""}`}
                                onClick={() => setActiveTab("profile")}
                            >
                                <i className="fas fa-user"></i>
                                <span>Профиль</span>
                            </button>
                            <button 
                                className={`nav-item ${activeTab === "referral" ? "active" : ""}`}
                                onClick={() => setActiveTab("referral")}
                            >
                                <i className="fas fa-users"></i>
                                <span>Рефералы</span>
                            </button>
                        </nav>
                    </div>
                </ErrorBoundary>
            );
        }

        const rootElement = document.getElementById("root");
        const root = ReactDOM.createRoot(rootElement);
        root.render(<App />);
    </script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</body>
</html>
